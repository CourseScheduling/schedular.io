var DROP_SPEED=300;function Instant(a){this.input=a.input;this.dropDown=a.dropDown;this.courseContainer=a.courseContainer;this.buttons=a.buttons;this.templates={};this.courses={};for(var c in a.templates)this.templates[c]=a.templates[c].cloneNode(!0),this.templates[c].id="";this.listen();a=UTIL.helper.localStorage.get("courses")||{};for(var b in a)this.addCourse(b)(),this.courses[b]=1;UTIL.helper.localStorage.set("courses",a);return this}
Instant.prototype.listen=function(){var a=this,c=this.input;c.addEventListener("keyup",function(b){b=c.value.trim();if(!b)return a.hideDrop();b=b.replace(/[^a-zA-Z\d\s:]/g,"");a.query(b,function(b){a.fillDrop(b);a.showDrop()})});[].forEach.call(this.buttons,function(b){b.addEventListener("click",function(){document.location=b.getAttribute("href")+"?c="+Object.keys(a.courses).join(",")})})};
Instant.prototype.fillDrop=function(a){for(;this.dropDown.children.length;)this.dropDown.removeChild(this.dropDown.children[0]);for(var c=0,b=a.length;c<b;c++){var d=this.templates.result.cloneNode(!0);d.getElementsByClassName("result__header")[0].innerHTML=a[c].title;d.getElementsByClassName("result__body")[0].innerHTML=a[c].name;d.onclick=this.addCourse(a[c].title);this.dropDown.appendChild(d)}};
Instant.prototype.query=function(a,c){var b=UTIL.helper.localStorage.get("token"),d=UTIL.helper.localStorage.get("UNIVERSITY");$.get({token:b,url:"/api/v1/"+d+"/search?q="+a,done:c})};Instant.prototype.hideDrop=function(){var a=this.dropDown;"block"===a.style.display&&Velocity(a,"slideUp",DROP_SPEED)};Instant.prototype.showDrop=function(){var a=this.dropDown;"block"!=a.style.display&&Velocity(a,"slideDown",DROP_SPEED)};
Instant.prototype.addCourse=function(a){var c=this;return function(){c.hideDrop();if(!c.courses[a]){var b=UTIL.helper.localStorage.get("courses");b[a]=1;c.courses[a]=1;UTIL.helper.localStorage.set("courses",b);b=c.templates.course.cloneNode(!0);b.style.backgroundColor=UTIL.helper.color.bgColor(a);b.getElementsByClassName("course__text")[0].innerHTML=a;c.courseContainer.appendChild(b);b.addEventListener("click",c.destroyCourse(b,a));c.input.value=""}}};
Instant.prototype.destroyCourse=function(a,c){var b=this;return function(d){delete b.courses[c];d=UTIL.helper.localStorage.get("courses");delete d[c];UTIL.helper.localStorage.set("courses",d);a.parentNode.removeChild(a)}};
window.Instant=new Instant({input:document.getElementById("courseInput"),dropDown:document.getElementById("dropDown"),courseContainer:document.getElementById("courseContainer"),templates:{result:document.getElementById("resultTemplate"),course:document.getElementById("courseTemplate")},buttons:document.getElementsByClassName("main__button")});
UTIL.helper.localStorage.get("UNIVERSITY")||new Modal({type:"select",header:"<strong>Hey!</strong> What university do you go to?",options:{sfu:"SFU - Simon Fraser University",ufv:"UFV - University of the Fraser Valley",ubc:"UBC - University of British Columbia"},onChoice:function(a){UTIL.helper.localStorage.set("UNIVERSITY",a,Date.now())}});